(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{195:function(t,e,n){},196:function(t,e,n){},198:function(t,e,n){},199:function(t,e,n){},205:function(t,e,n){"use strict";n.r(e);var a=n(1),r=n(0),i=n.n(r),o=n(75),c=n.n(o),l=n(30),s=(n(195),n(196),n(3)),u=n(8),h=function(t){return"number"===typeof t?t>0?t/1e4+" G":"Error":"Loading..."},d=n(20),g=n(21),f=n(2),p=function(t){return t.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"})},m=function(){function t(e,n,a,r){Object(d.a)(this,t);var i=this;i.size=a;var o=Object(u.a)(a,2),c=o[0],l=o[1];i.x=f.j().domain(n).range([0,c]),i.svg=e,i.g=i.svg.append("g"),i.labelL=i.g.append("text").attr("id","labelleft").attr("x",0).attr("y",l+15).attr("text-anchor","middle"),i.labelR=i.g.append("text").attr("id","labelright").attr("x",0).attr("y",l+15).attr("text-anchor","middle");i.brush=f.c().extent([[0,0],[c,l]]).on("brush",(function(t){var e=t.selection,n=i.x.invert(e[0]),a=i.x.invert(e[1]);i.labelL.attr("x",e[0]).text(p(n)),i.labelR.attr("x",e[1]).text(p(a)),i.handle.attr("display",null).attr("transform",(function(t,n){return"translate(".concat(e[n],", ").concat(-l/4,")")})),i.svg.node().value=e.map((function(t){return+i.x.invert(t)})),i.svg.node().dispatchEvent(new CustomEvent("input"));var o=function(t,e){var n=Object(u.a)(e,2),a=n[0],r=n[1];return t.map((function(t){var e=t.values.filter((function(t){return t.date<=r&&t.date>=a}));return{zone:t.zone,values:e}}))}(r.originalData,[n.getTime(),a.getTime()]);r.updateChart(o)})),i.gBrush=i.g.append("g").attr("class","brush").call(i.brush),i.handle=i.gBrush.selectAll(".handle--custom").data([{type:"w"},{type:"e"}]).enter().append("path").attr("class","handle--custom").attr("stroke","#000").attr("fill","#eee").attr("cursor","ew-resize").attr("d",(function(t){var e=+("e"===t.type),n=e?1:-1,a=l/2;return"M"+.5*n+","+a+"A6,6 0 0 "+e+" "+6.5*n+","+(a+6)+"V"+(2*a-6)+"A6,6 0 0 "+e+" "+.5*n+","+2*a+"ZM"+2.5*n+","+(a+8)+"V"+(2*a-8)+"M"+4.5*n+","+(a+8)+"V"+(2*a-8)})),i.gBrush.selectAll(".overlay").each((function(t){t.type="selection"})),this.updateValue(n)}return Object(g.a)(t,[{key:"updateValue",value:function(t){var e=this;e.gBrush.call(e.brush.move,t.map(e.x))}}]),t}(),v=(n(198),new(function(){function t(e,n){Object(d.a)(this,t),this.parentElement=e,this.config=n,this.showTooltip=!1,this.selectedZone=null}return Object(g.a)(t,[{key:"updateConfig",value:function(){var t=window.innerWidth,e=window.innerHeight;this.config.svgWidth=t/1.1,this.config.svgHeight=e/1.2>800?800:e/1.2,this.config.chartWidth=this.config.svgWidth-this.config.marginLeft-this.config.marginRight,this.config.chartHeight=this.config.svgHeight-this.config.marginTop-this.config.marginBottom-this.config.marginControllerHeight}},{key:"initChart",value:function(t){this.updateConfig();var e=this;e.originalData=t,e.svg=f.l(e.parentElement).append("svg").attr("width",e.config.svgWidth).attr("height",e.config.svgHeight),e.chart=e.svg.append("g").attr("transform","translate(".concat(e.config.marginLeft,", ").concat(e.config.marginTop+e.config.marginControllerHeight+20,")")),e.scaleX=f.j(),e.scaleY=f.h(),e.scaleZ=f.i(f.k),e.axisXCall=f.a().tickFormat(f.n("%m/%d/%Y")),e.axisYCall=f.b(),e.axisX=e.chart.append("g").attr("transform","translate(0, ".concat(e.config.chartHeight,")")),e.axisY=e.chart.append("g"),e.title=e.svg.append("text").attr("x",e.config.svgWidth/2).attr("y",e.config.marginTop/2).attr("text-anchor","middle").style("font-size","30px").style("font-weight","600").text(e.config.title),e.t=f.o().duration(e.config.transition||500),e.controller=e.svg.append("g").attr("transform","translate(".concat(e.config.marginLeft+.05*e.config.chartWidth,", ").concat(e.config.marginTop,")"));var n=f.d(t[0].values,(function(t){return t.date}));e.chartBgArea=e.chart.selectAll(".bgArea").data([1]).join("rect").attr("class","bgArea").attr("width",e.config.chartWidth).attr("height",e.config.chartHeight).attr("fill",e.config.chartBg).on("click",(function(){e.selectedZone=null})),e.chartBgLine=e.chart.selectAll(".y-dash-area").data([[[0,0],[e.config.chartWidth,0]]]).transition(e.t),e.legendContainer=e.chart.append("g").attr("class","legend"),e.toolTipContainer=e.chart.append("g").attr("class","tooltip-container").style("opacity","0"),e.toolTipDateLabel=e.toolTipContainer.selectAll(".tooltip-date-label").data([0]).join("text").attr("class","tooltip-date-label"),e.toolTipValueLabel=e.toolTipContainer.selectAll(".tooltip-value-label").data([0]).join("text").attr("class","tooltip-value-label"),e.slider=new m(e.controller,n,[.9*e.config.chartWidth,e.config.marginControllerHeight],e);var a,r=[(a=new Date(n[1]),new Date(a.getFullYear(),a.getMonth(),a.getDate()-7,a.getHours(),a.getMinutes(),a.getSeconds(),a.getMinutes())).getTime(),n[1]];e.slider.updateValue(r)}},{key:"updateChart",value:function(t){this.updateConfig();var e=this;e.data=t,e.dataDate=t[0].values.map((function(t){return t.date})),e.dataZone=t.map((function(t){return t.zone}));var n=e.config,a=n.chartWidth,r=n.chartHeight,i=n.chartBg,o=f.d(e.dataDate);e.scaleX.domain(o).range([0,a]);var c=[f.g(t,(function(t){return f.g(t.values,(function(t){return t.price}))})),f.f(t,(function(t){return f.f(t.values,(function(t){return t.price}))}))];e.scaleY.domain([.8*c[0],1.2*c[1]]).range([r,0]),e.axisXCall.scale(e.scaleX),e.axisX.call(e.axisXCall),e.axisYCall.scale(e.scaleY),e.axisY.call(e.axisYCall),e.toolTipDateLabel.attr("transform","translate(-60, ".concat(r+35,")")),e.chart.selectAll(".bgArea").attr("width",a).attr("height",r).attr("fill",i).on("mousemove",(function(t,n){var a=t.target.getBoundingClientRect(),r=t.clientX-a.left,i=e.scaleX.invert(r);if(e.toolTipDate=function(t,e){var n=t.findIndex((function(t){return t>=e}));if(0===n)return t[0];if(n>0){var a=t[n],r=t[n-1];return e-r>a-e?a:r}return e}(e.dataDate,i.getTime()),e.toolTipContainer.attr("transform","translate(".concat(e.scaleX(e.toolTipDate),", 0)")),e.toolTipDateLabel.text(function(t){return t.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}(new Date(e.toolTipDate))),null!=e.selectedZone){var o=e.dataZone.indexOf(e.selectedZone),c=e.data[o].values.find((function(t){return t.date===e.toolTipDate}));e.toolTipValueLabel.attr("transform","translate(10, ".concat(e.scaleY(c.price),")")).text("".concat(c.price,"G"))}})).on("click",(function(t,n){e.selectedZone=null,e.updateToolTips()}));var l=e.scaleY.ticks();l.shift();var s=l.map((function(t){return[[0,t],[a,t]]}));e.chartBgLine=e.chart.selectAll(".y-dash-area").data(s).join("line").attr("class","y-dash-area").attr("x1",(function(t){return t[0][0]})).attr("y1",(function(t){return e.scaleY(t[0][1])})).attr("x2",(function(t){return t[1][0]})).attr("y2",(function(t){return e.scaleY(t[1][1])}));var u=f.e().x((function(t){return e.scaleX(t.date)})).y((function(t){return e.scaleY(t.price)}));e.scaleZ.domain(t.map((function(t){return t.zone}))),e.paths=e.chart.selectAll(".zone-path-border").data(t).join("path").attr("class","zone-path-border").attr("id",(function(t){return"zone-border-".concat(t.zone)})).attr("d",(function(t){return u(t.values)})).attr("fill","none").style("stroke","black").style("stroke-width","4px").style("opacity","0"),e.paths=e.chart.selectAll(".zone-path").data(t).join("path").attr("class","zone-path").attr("d",(function(t){return u(t.values)})).attr("fill","none").style("stroke",(function(t){return e.scaleZ(t.zone)})).style("stroke-width","2px").on("mouseover",(function(t,e){f.m("#zone-border-".concat(e.zone)).style("opacity",1),f.l(this).style("cursor","pointer")})).on("mouseout",(function(t,e){f.m("#zone-border-".concat(e.zone)).style("opacity",0),f.l(this).style("cursor","default")})).on("click",(function(t,n){e.selectedZone=n.zone,e.updateToolTips()})),e.toolTipVerticalLine=e.toolTipContainer.selectAll(".tooltip-line").data([0]).join("line").attr("class","tooltip-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",r).attr("stroke-width",1).attr("stroke","black"),e.legendContainer.attr("transform","translate(".concat(a-100,", 10)")),e.legendContainer.selectAll(".legend-line").data(t.map((function(t){return t.zone}))).join("line").attr("class","legend-line").attr("x1",0).attr("y1",(function(t,e){return 15*e})).attr("x2",60).attr("y2",(function(t,e){return 15*e})).attr("stroke-width",2).attr("stroke",(function(t){return e.scaleZ(t)})),e.legendContainer.selectAll(".legend-text").data(t.map((function(t){return t.zone}))).join("text").attr("class","legend-text").attr("x",65).attr("y",(function(t,e){return 15*e+3})).attr("text-anchor","left").style("font-size","10px").style("font-weight","600").text((function(t){return t}))}},{key:"updateToolTips",value:function(){var t=this;null!=t.selectedZone?t.toolTipContainer.style("opacity",1):t.toolTipContainer.style("opacity",0)}}]),t}())("div#line-chart",{svgWidth:1e3,svgHeight:800,marginTop:50,marginControllerHeight:30,marginRight:30,marginBottom:60,marginLeft:60,chartBg:"lightyellow",chartWidth:1e3,chartHeight:800,barColor:"#1034a6",barHoverColor:"#0080ff",tooltipColor:"green",title:"World of Warcraft tokens chart"})),b=function(){return Object(r.useEffect)((function(){fetch("/api/wowToken/all").then((function(t){t.ok&&t.json().then((function(t){var e=function(t){return["CN","US","EU","KR","TW"].map((function(e,n){return{zone:e,values:t.map((function(t){return{date:t.d,price:t.p[n]>0?t.p[n]/1e4:t.p[n-1]/1e4}}))}}))}(t.tokens);v.initChart(e)}))}))}),[]),Object(a.jsx)("div",{id:"line-chart-container",children:Object(a.jsx)("div",{id:"line-chart"})})},x=(n(199),function(){var t=Object(r.useState)({type:0,msg:"Loading..."}),e=Object(u.a)(t,2),n=(e[0],e[1]),i=Object(r.useState)([]),o=Object(u.a)(i,2),c=o[0],l=o[1],s=Object(r.useState)(0),d=Object(u.a)(s,2),g=d[0],f=d[1];return Object(r.useEffect)((function(){var t=function(){return fetch("/api/wowToken").then((function(t){return t.ok?t.json().then((function(t){return n({type:2,msg:"WOW tokens"}),l(t),Promise.resolve()})):Promise.reject()})).catch((function(t){return Promise.reject()}))};t().then((function(){})).catch((function(){return fetch("/api/oauth2/credflow").then((function(t){return t.ok?(n({type:1,msg:"obtain access token successfully"}),f(1),Promise.resolve()):(n({type:-1,msg:"failed to obtain access token"}),Promise.reject())})).then((function(){return t().catch((function(){n({type:-2,msg:"failed to obtain access tokens with access token"})}))}))}))}),[g]),Object(a.jsxs)("div",{className:"token-table",children:[Object(a.jsx)("table",{children:Object(a.jsx)("tbody",{children:Object(a.jsxs)("tr",{children:[Object(a.jsxs)("td",{children:["CN: ",h(c[0])]}),Object(a.jsxs)("td",{children:["US: ",h(c[1])]}),Object(a.jsxs)("td",{children:["EU: ",h(c[2])]}),Object(a.jsxs)("td",{children:["KR: ",h(c[3])]}),Object(a.jsxs)("td",{children:["TW: ",h(c[4])]})]})})}),Object(a.jsx)(b,{})]})});var j=function(){return Object(a.jsx)("main",{children:Object(a.jsxs)(s.c,{children:[Object(a.jsx)(s.a,{exact:!0,path:"/",component:x}),Object(a.jsx)(s.a,{path:"/wowtoken",component:x})]})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(l.a,{children:Object(a.jsx)(j,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[205,1,2]]]);
//# sourceMappingURL=main.3e8fd2d7.chunk.js.map